<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>练习</title>
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/index.css" />
  </head>

  <body style="height: 1000px">
    <!--包裹器   整个页面的容器-->
    <div class="wrap">
      <!--窗口侧边栏-->
      <div class="toolBar toolWrap">
        <!--内容容器-->
        <div class="content"></div>
        <!--面包屑-->
        <div class="but list"></div>
        <!--中间列表-->
        <ul class="toolList">
          <li>
            <i class="tabIcon vip"></i>
            <em>尚品汇员</em>
          </li>
          <li>
            <i class="tabIcon cart"></i>
            <em>购物车</em>
          </li>
          <li>
            <i class="tabIcon follow"></i>
            <em>我的关注</em>
          </li>
          <li>
            <i class="tabIcon history"></i>
            <em>历史记录</em>
          </li>
          <li>
            <i class="tabIcon message"></i>
            <em>消息</em>
          </li>
          <li>
            <i class="tabIcon qus"></i>
            <em>咨询</em>
          </li>
        </ul>
        <!--回到顶部-->
        <div class="back">
          <i class="tabIcon"></i>
          <em></em>
        </div>
      </div>
      <!-- 头部区域 -->
      <header class="header">
        <!--头部第一行-->
        <div class="top">
          <div class="container">
            <!--登录-->
            <div class="login">
              <p>尚品汇欢迎您！</p>
              <p>
                <span>请</span>
                <a href="###">登录</a>
                <a href="###" class="register">免费注册</a>
              </p>
            </div>
            <!--头部导航-->
            <div class="headerNav">
              <a href="###">我的订单</a>
              <a href="###">我的购物车</a>
              <a href="###">我的尚品汇</a>
              <a href="###">尚品汇会员</a>
              <a href="###">企业采购</a>
              <a href="###">关注尚品汇</a>
              <a href="###">合作招商</a>
              <a href="###">商家后台</a>
            </div>
          </div>
        </div>
        <!--头部第二行-->
        <div class="bottom">
          <h1 class="logoArea">
            <a href="###">
              <img src="img/Logo.png" alt="尚品汇" />
            </a>
          </h1>
          <div class="searchArea">
            <form action="">
              <input type="text" />
              <button>搜索</button>
            </form>
          </div>
        </div>
      </header>
      <!--商品导航分类-->
      <div class="typeNav">
        <div class="container">
          <h2 class="all">全部商品分类</h2>
          <nav>
            <a href="###">服装城</a>
            <a href="###">美妆馆</a>
            <a href="###">尚品汇超市</a>
            <a href="###">全球购</a>
            <a href="###">闪购</a>
            <a href="###">团购</a>
            <a href="###">有趣</a>
            <a href="###">秒杀</a>
          </nav>
        </div>
      </div>
      <!--商品主要内容区域-->
      <section class="con">
        <!--路径导航-->
        <div class="conPoin">
          <!-- <a href="###">手机、数码、通讯</a>
        <a href="###">手机</a>
        <a href="###">Apple苹果</a>
        <a>iphone 6S系类</a> -->
        </div>
        <!--主要内容区域-->
        <div class="mainCon">
          <!--左侧放大镜-->
          <div class="previewWrap">
            <!--放大镜效果-->
            <div class="preview">
              <!--小图-->
              <div class="zoom">
                <!-- <img src="img/s1.png" alt=""> -->
              </div>
              <!--大图-->
            </div>
            <!--缩略图效果-->
            <div class="specScroll">
              <a class="prev">&lt;</a>
              <div class="itemCon">
                <ul class="list">
                  <!-- <li><img src="img/s1.png" alt=""></li>
                <li><img src="img/s2.png" alt=""></li>
                <li><img src="img/s3.png" alt=""></li>
                <li><img src="img/s1.png" alt=""></li>
                <li><img src="img/s2.png" alt=""></li>
                <li><img src="img/s3.png" alt=""></li>
                <li><img src="img/s1.png" alt=""></li>
                <li><img src="img/s2.png" alt=""></li> -->
                </ul>
              </div>
              <a class="next">&gt;</a>
            </div>
          </div>
          <!--右侧商品信息-->
          <div class="infoWrap">
            <div class="info1"></div>
            <div class="choose">
              <div class="chooseArea">
                <div class="choosed"></div>
              </div>
              <div class="carWrap">
                <div class="controls">
                  <input type="text" value="1" />
                  <a href="###" class="plus">+</a>
                  <a href="###" class="mins">-</a>
                </div>
                <div class="addBtn">
                  <a href="###">加入购物车</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!--商品详情页-->
      <section class="productDetail">
        <!--侧边栏-->
        <aside class="aside">
          <!--选项卡切换的按钮-->
          <div class="tabWrap">
            <h4 class="active">相关分类</h4>
            <h4>推荐品牌</h4>
          </div>
          <!--选项卡内容-->
          <div class="tabContent">
            <div class="active">
              <ul class="partList">
                <li>手机</li>
                <li>手机壳</li>
                <li>内存卡</li>
                <li>iphone配件</li>
                <li>贴膜</li>
                <li>手机耳机</li>
                <li>移动电源</li>
                <li>平板电脑</li>
              </ul>
              <ul class="goodsList">
                <li>
                  <div class="gImg">
                    <img src="img/part01.png" alt="" />
                  </div>
                  <p class="attr">Apple苹果iPhone 6s (A1699)</p>
                  <p class="price">¥6088.00</p>
                  <div class="addCar">
                    <a href="###">加入购物车</a>
                  </div>
                </li>
                <li>
                  <div class="gImg">
                    <img src="img/part02.png" alt="" />
                  </div>
                  <p class="attr">Apple苹果iPhone 6s (A1699)</p>
                  <p class="price">¥6088.00</p>
                  <div class="addCar">
                    <a href="###">加入购物车</a>
                  </div>
                </li>
                <li>
                  <div class="gImg">
                    <img src="img/part03.png" alt="" />
                  </div>
                  <p class="attr">Apple苹果iPhone 6s (A1699)</p>
                  <p class="price">¥6088.00</p>
                  <div class="addCar">
                    <a href="###">加入购物车</a>
                  </div>
                </li>
                <li>
                  <div class="gImg">
                    <img src="img/part01.png" alt="" />
                  </div>
                  <p class="attr">Apple苹果iPhone 6s (A1699)</p>
                  <p class="price">¥6088.00</p>
                  <div class="addCar">
                    <a href="###">加入购物车</a>
                  </div>
                </li>
              </ul>
            </div>
            <div>推荐品牌</div>
          </div>
        </aside>
        <div class="detail">
          <div class="fitting">
            <h4>选择搭配</h4>
            <div class="goodSuits">
              <div class="master">
                <img src="img/l-m01.png" alt="" />
                <p>¥5299</p>
                <i>+</i>
              </div>
              <ul class="suits">
                <li class="suitsItem">
                  <img src="img/dp01.png" alt="" />
                  <p>Feless费勒斯VR</p>
                  <label>
                    <input type="checkbox" value="39" />
                    <span>39</span>
                  </label>
                </li>
                <li class="suitsItem">
                  <img src="img/dp02.png" alt="" />
                  <p>Feless费勒斯VR</p>
                  <label>
                    <input type="checkbox" value="39" />
                    <span>39</span>
                  </label>
                </li>
                <li class="suitsItem">
                  <img src="img/dp03.png" alt="" />
                  <p>Feless费勒斯VR</p>
                  <label>
                    <input type="checkbox" value="39" />
                    <span>39</span>
                  </label>
                </li>
                <li class="suitsItem">
                  <img src="img/dp04.png" alt="" />
                  <p>Feless费勒斯VR</p>
                  <label>
                    <input type="checkbox" value="39" />
                    <span>39</span>
                  </label>
                </li>
              </ul>
              <div class="result">
                <div>已选购0件商品</div>
                <p class="price-tit">套餐价</p>
                <p class="price">¥5299</p>
                <button>加入购物车</button>
              </div>
            </div>
          </div>
          <div class="intro">
            <ul class="tabWrap">
              <li class="active"><a href="###">商品介绍</a></li>
              <li><a href="###">规格与包装</a></li>
              <li><a href="###">售后保障</a></li>
              <li><a href="###">商品评价</a></li>
              <li><a href="###">手机社区</a></li>
            </ul>
            <div class="tabContent">
              <div class="active">
                <ul class="goodsIntro">
                  <li>分辨率：1920*1080(FHD)</li>
                  <li>后置摄像头：1200万像素</li>
                  <li>前置摄像头：500万像素</li>
                  <li>核 数：其他</li>
                  <li>频 率：以官网信息为准</li>
                  <li>品牌： Apple</li>
                  <li>商品名称：APPLEiPhone 6s Plus</li>
                  <li>商品编号：1861098</li>
                  <li>商品产地：中国大陆</li>
                  <li>商品毛重：0.51kg</li>
                  <li>热点：指纹识别，Apple Pay，金属机身，拍照神器</li>
                </ul>
                <div class="introImg">
                  <img src="img/intro01.png" alt="" />
                  <img src="img/intro02.png" alt="" />
                  <img src="img/intro03.png" alt="" />
                </div>
              </div>
              <div>规格与包装</div>
              <div>售后保障</div>
              <div>商品评价</div>
              <div>手机社区</div>
            </div>
          </div>
        </div>
      </section>
    </div>
    <!-- 引入数据得js -->
    <script src="./js/data.js"></script>

    <script>
      // 设定延时
      window.addEventListener('DOMContentLoaded', function () {
        initCrumbs();
        tabLeftClick();
        tabButtomClick();
        zoom();
        thumb();
        thumbClick();
        goodsBaseInfo();
        goodsParamsInfo();
        goodsParamsClick();
      });
      var imgIndex = 0; // 记录单击缩略图的下标

      // 面包屑导航
      function initCrumbs() {
        var crumbsData = goodData.path;
        var htmlStr = '';
        // console.log(crumbsData);
        crumbsData.forEach(function (item, index) {
          if (index !== crumbsData.length - 1) {
            htmlStr += `<a href = '${item.url}'>${item.title}</a>`;
          } else {
            htmlStr += `<a>${item.title}</a>`;
          }
        });
        // 把内容作为class=conPoin的内容
        var crumbEle = document.querySelector('.con .conPoin');
        crumbEle.innerHTML = htmlStr;
      }

      // 左侧选项卡
      function tabLeftClick() {
        var tabs = document.querySelectorAll(
          '.wrap .productDetail .aside .tabWrap h4'
        );
        Array.from(tabs).forEach(function (item, index) {
          item.onclick = function () {
            for (var i = 0; i < tabs.length; i++) {
              tabs[i].classList.remove('active');
            }
            this.classList.add('active');

            var boxTabs = document.querySelectorAll(
              '.wrap .productDetail .aside .tabContent > div'
            );
            console.log(boxTabs);
            for (var j = 0; j < boxTabs.length; j++) {
              boxTabs[j].classList.remove('active');
            }
            boxTabs[index].classList.add('active');
          };
        });
      }

      // 底部选项卡
      function tabButtomClick() {
        var tabs = document.querySelectorAll(
          '.wrap .productDetail .detail .intro .tabWrap li'
        );

        for (let i = 0; i < tabs.length; i++) {
          tabs[i].onclick = function () {
            for (var j = 0; j < tabs.length; j++) {
              tabs[j].classList.remove('active');
            }
            this.classList.add('active');

            var boxTabs = document.querySelectorAll(
              '.wrap .productDetail .detail .intro .tabContent > div'
            );
            for (var k = 0; k < tabs.length; k++) {
              boxTabs[k].classList.remove('active');
            }
            boxTabs[i].classList.add('active');
          };
        }
      }

      // 放大镜
      function zoom() {
        var smallImgBox = document.querySelector(
          '.wrap .con .mainCon .previewWrap .preview .zoom'
        );
        var preview = document.querySelector(
          '.wrap .con .mainCon .previewWrap .preview'
        );

        // 将图片传输到页面上
        var smallImg = new Image();
        smallImg.src = goodData.imgsrc[0].s;
        smallImgBox.appendChild(smallImg);

        // 给小图绑定鼠标悬浮事件，将别的元素抽离出来
        var mask = null;
        var bigImgBox = null;
        var bigImg = null;

        smallImgBox.onmouseenter = function () {
          // 创建mask
          mask = document.createElement('div');
          mask.className = 'mask';

          // 创建大图容器
          bigImgBox = document.createElement('div');
          bigImgBox.className = 'bigBox';

          // 创建大图片
          bigImg = new Image();
          bigImg.src = goodData.imgsrc[imgIndex].b;

          // DOM上树
          smallImgBox.appendChild(mask);
          bigImgBox.appendChild(bigImg);
          preview.appendChild(bigImgBox);

          // 给小图容器绑定移动事件
          smallImgBox.onmousemove = function (even) {
            even = even || window.even;

            // 获取遮盖德left和top坐标
            var maskLeft =
              even.clientX -
              mask.offsetWidth / 2 -
              smallImgBox.getBoundingClientRect().left;

            var maskTop =
              even.clientY -
              mask.offsetHeight / 2 -
              smallImgBox.getBoundingClientRect().top;

            // 获取遮盖最大的移动距离left：小图片容器宽度 - 遮盖宽度
            var maskMaxMoveLeft = smallImgBox.clientWidth - mask.offsetWidth;
            var maskMaxMoveTop = smallImgBox.clientHeight - mask.offsetHeight;

            // 限制遮盖移动位置
            if (maskLeft > maskMaxMoveLeft) {
              maskLeft = maskMaxMoveLeft;
            } else if (maskLeft < 0) {
              maskLeft = 0;
            }

            if (maskTop > maskMaxMoveTop) {
              maskTop = maskMaxMoveTop;
            } else if (maskTop < 0) {
              maskTop = 0;
            }

            // 给mask移动位置赋值
            mask.style.left = maskLeft + 'px';
            mask.style.top = maskTop + 'px';

            // 控制大图的移动
            // 比例关系： 遮盖的移动距离 / 遮盖最大的移动距离 = 大图的移动距离(未知) / 大图最大的移动距离（未知）
            // 大图最大的移动距离left = 大图宽度 - 大盒的宽度
            var bigImgMaxLeft = bigImg.clientWidth - bigImgBox.offsetWidth;
            // 大图最大的移动距离top = 大图高度 - 大盒的高度
            var bigImgMaxTop = bigImg.clientHeight - bigImgBox.offsetHeight;

            // 大图的移动距离 = (遮盖的移动距离 * 大图最大的移动距离) / 遮盖最大的移动距离
            var bigImgLeft = (maskLeft * bigImgMaxLeft) / maskMaxMoveLeft;
            var bigImgTop = (maskTop * bigImgMaxTop) / maskMaxMoveTop;

            // 设置大图的left和top
            bigImg.style.left = -bigImgLeft + 'px';
            bigImg.style.top = -bigImgTop + 'px';

            // 给小图容器绑定移动事件
            smallImgBox.onmouseleave = function () {
              // DOM树中要销毁遮盖，大图容器
              smallImgBox.removeChild(mask);
              preview.removeChild(bigImgBox);

              // 防止内存泄漏，要解除DOM的引用
              mask = bigImgBox = bigImg = null;
              // 解绑鼠标移动和离开事件
              smallImgBox.onmousemove = null;
              smallImgBox.onmouseleave = null;
            };
          };
        };
      }

      // 初始化缩略图数据
      function thumb() {
        // 思路：获取图片的数据，动态创建li节点，li中再追加img标签
        goodData.imgsrc.forEach(function (item, index) {
          var liNode = document.createElement('li');
          var thumbImg = new Image();
          thumbImg.src = item.s;
          liNode.appendChild(thumbImg);
          // 把li动态添加到list当中
          var list = document.querySelector(
            '.wrap .con .mainCon .previewWrap .specScroll .itemCon .list'
          );
          list.appendChild(liNode);
        });

        // 给左右箭头绑定事件，移动图片
        var next = document.querySelector(
          '.wrap .con .mainCon .previewWrap .specScroll .next'
        );
        var prev = document.querySelector(
          '.wrap .con .mainCon .previewWrap .specScroll .prev'
        );
        // 获取ul 和 里面保函图片的 li
        var list = document.querySelector(
          '.wrap .con .mainCon .previewWrap .specScroll .itemCon .list'
        );
        var lis = document.querySelectorAll(
          '.wrap .con .mainCon .previewWrap .specScroll .itemCon .list > li'
        );

        // 获取dom节点最终的渲染之后的样式
        var marginRight = parseInt(window.getComputedStyle(lis[0]).marginRight);

        // 每次移动距离 = li宽度 + li右外边距
        var stepMoveLeft = lis[0].offsetWidth + marginRight;

        var num = 5;
        // 限制ul最大的移动距离 = （li节点个数 - num） * 每次移动的距离
        var listMaxMoveLeft = (lis.length - num) * stepMoveLeft;

        var moveLeft = 0;
        //右箭头
        next.onclick = function () {
          if (moveLeft >= listMaxMoveLeft) {
            return;
          }
          moveLeft += stepMoveLeft;
          list.style.left = -moveLeft + 'px';
        };

        prev.onclick = function () {
          if (moveLeft === 0) {
            return;
          }
          moveLeft -= stepMoveLeft;
          list.style.left = -moveLeft + 'px';
        };
      }

      // 给缩略图绑定事件
      function thumbClick() {
        var imgs = document.querySelectorAll(
          '.wrap .con .mainCon .previewWrap .specScroll .itemCon .list > li img'
        );
        var smallImg = document.querySelector(
          '.wrap .con .mainCon .previewWrap .preview .zoom img'
        );

        Array.from(imgs).forEach(function (item, index) {
          item.onclick = function () {
            console.log(22);
            smallImg.src = this.src;
            imgIndex = index;
          };
        });
      }

      // 商品参数信息  未完成.....
      function goodsBaseInfo() {
        // 把3字符串中的数据替换为data.计算中的数据
        var goods = goodData.goodsDetail;
        // 2.把替换好的字符串作为info的节点内容
        var goodsNode = document.querySelector(
          '.wrap .con .mainCon .infoWrap .info1'
        );
        var info = `<h3 class="infoName">${goods.title}</h3>
                    <p class="news">${goods.recommend}</p>
                    <div class="priceArea">
                      <div class="priceArea1">
                        <div class="title">价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</div>
                        <div class="price">
                          <i>￥</i>
                          <em>${goods.price}</em>
                          <span>降价通知</span>
                        </div>
                        <div class="remark">
                          <i>累计评价</i>
                          <span>${goods.evaluateNum}</span>
                        </div>
                      </div>
                      <div class="priceArea2">
                        <div class="title">促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</div>
                        <div class="fixWidth">
                          <i>${goods.promoteSales.type}</i>
                          <span>${goods.promoteSales.content} </span>
                        </div>
                      </div>
                    </div>
                    <div class="support">
                      <div>
                        <div class="title">支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</div>
                        <div class="fixWidth">${goods.support}</div>
                      </div>
                      <div>
                        <div class="title">配&nbsp;送&nbsp;至</div>
                        <div class="fixWidth">${goods.address}</div>
                      </div>
                    </div>`;

        goodsNode.innerHTML = info;

        // var leftPricNode = document.querySelector(
        //   '.wrap .productDetail .detail .fitting .goodSuits .master p'
        // );

        // var rightPriceNode = document.querySelector(
        //   '.wrap .productDetail .detail .fitting .goodSuits .result .price'
        // );

        // var totalPrice = goods.price;
        // leftPriceNode.innerText = '¥' + totalPrice;

        // // 还要考虑复选框默认中的价格，累加到右边的价格
        // var input = document.querySelectorAll('.wrap .productDetail .detail .fitting .goodSuits .suits .suitsItem input');
      }

      function goodsParamsInfo() {
        /**
         * 思路：
         * 1. 获取商品参数数据（data.js）
         * 2. 循环数据，动态创建dl(dt，dd)
         * 3. 动态追加到页面指定的节点中
         */

        //  1.获取商品参数数据(data.js)
        var goodsParams = goodData.goodsDetail.crumbData;

        goodsParams.forEach(function (param) {
          // console.log(param);
          // 创建dl
          var dlNode = document.createElement('dl');

          // 创建dt
          var dtNode = document.createElement('dt');
          dtNode.innerText = param.title;
          // dt追加到dl
          dlNode.appendChild(dtNode);

          // 创建dd节点
          param.data.forEach(function (info) {
            var ddNode = document.createElement('dd');
            ddNode.innerText = info.type;
            // 给dd额外添加自定义属性price，便于后面单击获取
            ddNode.setAttribute('price', info.changePrice);
            dlNode.appendChild(ddNode);
          });

          // 动态追加到页面指定的节点中
          var chooseAreaNode = document.querySelector(
            '.wrap .con .mainCon .infoWrap .choose .chooseArea'
          );
          chooseAreaNode.appendChild(dlNode);
        });
      }

      // 给商品参数绑定单击事件
      function goodsParamsClick() {
        /**
         * 思路：
         * 1. 获取所有dl,并循环，找到指定下标里面的所有的dd
         * 2. 给dd循环绑定单击事件
         * 3. 单击时，把当前dd设置红色，同辈兄弟元素dd要改为灰色
         * 4. 把单击的参数条件记录在一个数组中，并在筛选条件容器中进行展示
         * 5. 把在数组中已经选中的条件动态创建mark标签，并插入到底指定页面筛选结果容器中
         */

        //  1.获取所有的dl，并循环， 找到指定下标里面的所有dd
        var dlsNode = document.querySelectorAll(
          '.wrap .con .mainCon .infoWrap .choose .chooseArea dl'
        );
        var result = new Array(4);
        result.fill(0); // 给数组元素都填充为0，代表都没有选中条件
        dlsNode.forEach(function (dlNode, index) {
          // 以dl为父节点，找其下面名为dd的子节点
          var ddsNode = dlNode.querySelectorAll('dd');
          console.log(ddsNode);
          // 给dd循环绑定单击事件
          ddsNode.forEach(function (ddNode) {
            ddNode.onclick = function () {
              // 通过循环dl的下标index找到指定dl,同辈兄弟元素dd要改为灰色
              ddsNode.forEach(function (d) {
                // 3. 单击时，把当前dd设置红色，同辈兄弟元素dd要改为灰色
                d.style.color = '#666';
              });
              this.style.color = 'red';

              //  4. 把单击的参数条件记录在一个数组中，并在筛选条件容器中进行展示
              // 必须给对应的dl的下标设置选中的条件，这样才会保存同一组dl某个条件，覆盖dl中同一个条件
              // this是当前的dd节点
              result[index] = this  // .innerText;
              
              // 5. 把在数组中已经选中的条件动态创建mark标签，并插入到底指定页面筛选结果容器中
              // 每次重新创建追加mark节点之前,清空已经选中的条件节点内容
              var choosed = document.querySelector('.wrap .con .mainCon .infoWrap .choose .choosed')
              choosed.innerText = ''
              result.forEach(function (paramValue, index) {
                if(!paramValue){
                   return
                   }
                var markNode = document.createElement('mark')
                markNode.innerText = paramValue.innerText
                var aNode = document.createElement('a');
                aNode.innerText = 'X'
                // 记录当前条件所在原来的对应dl的下标，便于后面删除的时候，可以找到对应的dl标签
                aNode.setAttribute('resultIndex', index);
                // mark追加a节点
                markNode.appendChild(aNode);
                // 把mark追加指定容器中进行展示
                choosed.appendChild(markNode)
              })
              // 6对创建的mark节点中的a标签绑定单击事件
              var aNodes = document.querySelectorAll('.wrap .con .mainCon .infoWrap .choose .chooseArea .choosed mark a')
              aNodes.forEach(function(aNode, index) {
                aNode.onclick = function() {
                  // 1. 移除a节点父亲（mask）
                 var maskNode = this.parentElement;
                 // 2. 删除其在result对应的条件,通过原来存储的dl下标来寻找 
                 var origiDlIndex = this.getAttribute('resultIndex')
                 result[origiDlIndex] = 0;
                 maskNode.parentNode.removeChild(maskNode);
                //  3.找到对应原来下标的dl元素，把所有的dd文字改为灰色，把第一个及下标为0改为红色
                var ddNodes = dlsNode[origiDlIndex].querySelectorAll('dd')
                ddNodes.forEach(function(ddNode) {
                  ddNode.style.color = '#666'
                })
                ddNodes[0].style.color = 'red'
                }
              })
            };
          });
        });
      }
    </script>
  </body>
</html>
